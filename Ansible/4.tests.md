![](https://github.com/jcorvid509/.resGen/blob/main/_bannerD.png#gh-dark-mode-only)
![](https://github.com/jcorvid509/.resGen/blob/main/_bannerL.png#gh-light-mode-only)

<a href="/README.md"><img src="https://github.com/jcorvid509/.resGen/blob/main/_home.svg" width="30"></a>

<a href="3.despliegue.md"><img src="https://github.com/jcorvid509/.resGen/blob/main/_arrow_r.svg" width="30"></a>
&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
<a href="4.values.md"><img src="https://github.com/jcorvid509/.resGen/blob/main/_arrow.svg" width="30"></a>

---

# Valores

> Usando ansible, podemos almacenar valores en una variable para su posterior uso en el playbook.

Para ello, hemos de modificar el archivo principal `mai.yml` añadiendo un nuevo rol:

```bash
nano main.yml
```

```yml
- hosts: webservers
  remote_user: "root"
  roles:
#  - role: nginx_install
  - role: register_variable # nuevo rol
```

Para poder usar el nuevo rol, hemos de crearlo dentro del fichero `roles`

```bash
mkdir roles/register_variable/tasks
```

Dentro de la carpeta `tasks` hemos de crear un archivo llamado `main.yml` con el siguiente contenido:

```bash
nano roles/register_variable/tasks/main.yml
```

```yml
---
# registrar variable

- name: check if file exists
  stat:
    path: "/root/ansible/file"  # cargamos el fichero
  register: file_exists         # registramos la variable file_exists
```

# Añadir condiciones a playbook

> Las condiciones controlan si una `tarea` o función se **ejecuta** o se **omite**.

Comprobaremos su funcion creando un nuevo rol.

```bash
nano main.yml
```

```yml
- hosts: webservers
  remote_user: "root"
  roles:
#  - role: nginx_install
#  - role: register_variable
  - role: conditions           # nuevo rol
```

Para poder usar el nuevo rol, hemos de crearlo dentro del fichero `roles`

```bash
mkdir roles/conditions/tasks
```

Dentro de la carpeta `tasks` hemos de crear un archivo llamado `main.yml` con el siguiente contenido:

```bash
nano roles/conditions/tasks/main.yml
```

```yml
---
# register variable
- name: check if file exists
  stat:
    path: "/root/ansible/file"  # cargamos el fichero
  register: file_exists         # registramos la variable file_exists

# debug
- name: debug if file exists
  debug:
    msg: "El fichero existe"            # mensaje si existe
  when: file_exists.stat.exists == True # condición para mostrar el mensaje

- name: debug if file does not exist
  debug:
    msg: "El fichero no existe"             # mensaje si no existe
  when: file_exists.stat.exists == False    # condición para mostrar el mensaje


# create file if does not exist
- name: create file
  file:
    path: "/root/ansible/file"              # fichero a crear
    state: touch                            # crear el fichero si no existe
  when: file_exists.stat.exists == False    # condición para crear el fichero
```

# Forzar fallos

Comprobaremos su funcion creando un nuevo rol.

```bash
nano main.yml
```

```yml
- hosts: webservers
  remote_user: "root"
  roles:
#  - role: nginx_install
#  - role: register_variable
#  - role: conditions           # nuevo rol
  - role: fail_force
```